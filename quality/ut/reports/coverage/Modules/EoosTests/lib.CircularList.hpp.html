<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>lib.CircularList.hpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
/**
 * @file      lib.CircularList.hpp
 * @author    Sergey Baigudin, sergey@baigudin.software
 * @copyright 2014-2022, Sergey Baigudin, Baigudin Software
 */
#ifndef LIB_CIRCULARLIST_HPP_
#define LIB_CIRCULARLIST_HPP_

#include "lib.AbstractList.hpp"

namespace eoos
{
namespace lib
{
    
/**
 * @class CircularList&lt;T,A&gt;
 * @brief Circular doubly linked list.
 *
 * @tparam T Data type of container element.
 * @tparam A Heap memory allocator class.
 */
template &lt;typename T, class A = Allocator&gt;
class CircularList : public AbstractList&lt;T,A&gt;
{
    typedef AbstractList&lt;T,A&gt; Parent;

public:

    using Parent::isConstructed;

    /**
     * @brief Constructor.
     */
    CircularList() 
<span style = "background-color:#dfd">        : AbstractList&lt;T,A&gt;() {
    }</span>

    /**
     * @brief Constructor.
     *
     * @param illegal An illegal element.
     */
    CircularList(T const illegal) 
<span style = "background-color:#dfd">        : AbstractList&lt;T,A&gt;(illegal) {
    }</span>

    /**
     * @brief Destructor.
     */
    virtual ~CircularList()
<span style = "background-color:#dfd">    {
    }</span>

    /**
     * @copydoc eoos::api::List::getListIterator(int32_t)
     */
    virtual api::ListIterator&lt;T&gt;* getListIterator(int32_t const index=0)
<span style = "background-color:#dfd">    {
        Iterator&lt;T,A&gt;* it( NULLPTR );
        if( isConstructed() )</span>
        {
<span style = "background-color:#dfd">            it = new Iterator&lt;T,A&gt;(index, *this);
            if( it != NULLPTR )</span>
            {
<span style = "background-color:#dfd">                if( !it-&gt;isConstructed() )</span>
                {
<span style = "background-color:#dfd">                    delete it;
                    it = NULLPTR;</span>
                }
            }
        }
<span style = "background-color:#dfd">        return it;         
    }</span>

protected:

    using Parent::setConstructed;

private:
    
    /**
     * @class Iterator
     * @brief The list iterator.
     *
     * @note This class is implemented in private zone of the list class.
     * For this reason, for fast iteration some tests are skipped.
     * You have to use this class only if it has been constructed.
     *
     * @tparam TT Data type of container element.
     * @tparam AA Heap memory allocator class.
     */
    template &lt;typename TT, class AA&gt;
    class Iterator : public NonCopyable&lt;AA&gt;, public api::ListIterator&lt;TT&gt;
    {
        typedef NonCopyable&lt;AA&gt; Parent;
        typedef CircularList&lt;TT,AA&gt;  List;
        typedef LinkedNode&lt;TT,AA&gt; Node;        

    public:

        /**
         * @brief Constructor.
         *
         * @param index Position in this list.
         * @param list  Reference to self list.
         */
        Iterator(int32_t const index, List&amp; list) 
<span style = "background-color:#dfd">            : NonCopyable&lt;AA&gt;()
            , api::ListIterator&lt;TT&gt;()
            , list_    (list)
            , count_   (list.getReferenceToCount())
            , last_    (list.getReferenceToLast())
            , illegal_ (list.getReferenceToIllegal())
            , curs_    (NULLPTR)
            , rindex_  (ILLEGAL_INDEX) {
            bool_t const  isConstructed( construct(index) );
            this-&gt;setConstructed( isConstructed );
        }</span>

        /**
         * @brief Destructor.
         */
<span style = "background-color:#dfd">        virtual ~Iterator(){}</span>

        /**
         * @copydoc eoos::api::Object::isConstructed()
         */
        virtual bool_t isConstructed() const ///&lt; SCA MISRA-C++:2008 Defected Rule 9-3-3
<span style = "background-color:#dfd">        {
            return Parent::isConstructed();
        }</span>

        /**
         * @copydoc eoos::api::ListIterator::add(T const&amp;)
         */
        virtual bool_t add(TT const&amp; element)
<span style = "background-color:#dfd">        {
            if( isModifiedByList() )</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            bool_t const wasEmpty( list_.isEmpty() );
            int32_t const index = ( wasEmpty ) ? 0 : curs_-&gt;getIndex(); 
            bool_t const res( list_.add(index, element) );
            if( res == true )</span>
            {
<span style = "background-color:#dfd">                count_.self++; ///&lt; SCA MISRA-C++:2008 Defected Rule 5-2-10
                rindex_ = ILLEGAL_INDEX;
                if( wasEmpty )</span>
                {
<span style = "background-color:#dfd">                    curs_ = last_;</span>
                }
            }            
<span style = "background-color:#dfd">            return res;
        }</span>

        /**
         * @copydoc eoos::api::Iterator::remove()
         */
        virtual bool_t remove()
<span style = "background-color:#dfd">        {
            if( isModifiedByList() )</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            if(rindex_ == ILLEGAL_INDEX)</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            Node* curs( curs_ );            
            if(curs_-&gt;getIndex() == rindex_)</span>
            {
<span style = "background-color:#dfd">                curs = curs_-&gt;getNext();</span>
            }
<span style = "background-color:#dfd">            bool_t res( list_.remove(rindex_) );            
            if(res == true)</span>
            {
<span style = "background-color:#dfd">                count_.self++; ///&lt; SCA MISRA-C++:2008 Defected Rule 5-2-10
                rindex_ = ILLEGAL_INDEX;
                curs_ = ( list_.isEmpty() ) ? NULLPTR : curs;</span>
            }
<span style = "background-color:#dfd">            return res;
        }</span>

        /**
         * @copydoc eoos::api::ListIterator::getPrevious()
         */
        virtual TT&amp; getPrevious()
<span style = "background-color:#dfd">        {
            if( !hasPrevious())</span>
            {
<span style = "background-color:#dfd">                rindex_ = ILLEGAL_INDEX;                
                return illegal_; ///&lt; SCA MISRA-C++:2008 Justified Rule 9-3-2</span>
            }
<span style = "background-color:#dfd">            curs_ = curs_-&gt;getPrevious();
            rindex_ = curs_-&gt;getIndex();
            return curs_-&gt;getElement();
        }</span>

        /**
         * @copydoc eoos::api::ListIterator::getPreviousIndex()
         */
        virtual int32_t getPreviousIndex() const
<span style = "background-color:#dfd">        {
            if( isModifiedByList() )</span>
            {
<span style = "background-color:#dfd">                return api::ListIterator&lt;TT&gt;::ERROR_INDEX;</span>
            }                        
<span style = "background-color:#dfd">            return hasPrevious() ? curs_-&gt;getPrevious()-&gt;getIndex() : -1;
        }</span>

        /**
         * @copydoc eoos::api::ListIterator::hasPrevious()
         */
        virtual bool_t hasPrevious() const
<span style = "background-color:#dfd">        {
            if( isModifiedByList() )</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            if(curs_ == NULLPTR)</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            return true;
        }</span>

        /**
         * @copydoc eoos::api::Iterator::getNext()
         */
        virtual TT&amp; getNext()
<span style = "background-color:#dfd">        {
            if( !hasNext() )</span>
            {
<span style = "background-color:#dfd">                rindex_ = ILLEGAL_INDEX;                
                return illegal_; ///&lt; SCA MISRA-C++:2008 Justified Rule 9-3-2</span>
            }
<span style = "background-color:#dfd">            Node* const node( curs_ );
            curs_ = curs_-&gt;getNext();
            rindex_ = node-&gt;getIndex();
            return node-&gt;getElement();
        }</span>

        /**
         * @copydoc eoos::api::ListIterator::getNextIndex()
         */
        virtual int32_t getNextIndex() const
<span style = "background-color:#dfd">        {
            if( isModifiedByList() )</span>
            {
<span style = "background-color:#dfd">                return api::ListIterator&lt;TT&gt;::ERROR_INDEX;</span>
            }
<span style = "background-color:#dfd">            return hasNext() ? curs_-&gt;getIndex() : -1;
        }</span>

        /**
         * @copydoc eoos::api::Iterator::hasNext()
         */
        virtual bool_t hasNext() const
<span style = "background-color:#dfd">        {
            if( isModifiedByList() )</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            if(curs_ == NULLPTR)</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            return true;
        }</span>

        /**
         * @copydoc eoos::api::IllegalValue::getIllegal()
         */
        virtual TT const&amp; getIllegal() const
<span style = "background-color:#dfd">        {
            return list_.getIllegal();
        }</span>

        /**
         * @copydoc eoos::api::IllegalValue::setIllegal(T const&amp;)
         */
        virtual void setIllegal(TT const&amp; value)
<span style = "background-color:#dfd">        {
            list_.setIllegal(value);
        }</span>

        /**
         * @copydoc eoos::api::IllegalValue::isIllegal(T const&amp;)
         */
        virtual bool_t isIllegal(TT const&amp; value) const
<span style = "background-color:#dfd">        {
            return list_.isIllegal(value);
        }</span>

    private:

        /**
         * @brief Constructor.
         *
         * @param index position in this list.
         */
        bool_t construct(int32_t index)
<span style = "background-color:#dfd">        {
            if( !isConstructed() )</span>
            {   ///&lt; UT Justified Branch: HW dependency
<span style = "background-color:#fdd">                return false;</span>
            }
<span style = "background-color:#dfd">            if( !list_.isConstructed())</span>
            {   ///&lt; UT Justified Branch: HW dependency
<span style = "background-color:#fdd">                return false;</span>
            }
<span style = "background-color:#dfd">            if( list_.isIndexOutOfBounds(index) )</span>
            {
<span style = "background-color:#dfd">                return false;</span>
            }
<span style = "background-color:#dfd">            if( !list_.isEmpty() )</span>
            {
<span style = "background-color:#dfd">                if( static_cast&lt;size_t&gt;(index) == list_.getLength() )</span>
                {
<span style = "background-color:#dfd">                    return false;</span>
                }
<span style = "background-color:#dfd">                curs_ = list_.getNodeByIndex(index);</span>
            }
<span style = "background-color:#dfd">            return true;
        }</span>
        
        /**
         * @brief Tests if list was modified by list object.
         *
         * @param true if modified.
         */
        bool_t isModifiedByList() const
<span style = "background-color:#dfd">        {        
            return count_.list != count_.self;
        }</span>
        
        /**
         * @brief List changing counter.
         */
        struct Counter
        {
            /**
             * @brief Constructor.
             */
            Counter(uint32_t&amp; count)
<span style = "background-color:#dfd">                : list (count)
                , self (count) {
            }</span>

            /**
             * @brief Destructor.
             */
           ~Counter()
<span style = "background-color:#dfd">            {
            }</span>

            /**
             * @brief Quantity of chang made by iterating list.
             */
            uint32_t const&amp; list; ///&lt; SCA MISRA-C++:2008 Justified Rule 11-0-1

            /**
             * @brief Quantity of chang made by the iterator.
             */
            uint32_t self; ///&lt; SCA MISRA-C++:2008 Justified Rule 11-0-1

        };

        /**
         * @brief Illegal iterator index
         */
        static const int32_t ILLEGAL_INDEX = -1;

        /**
         * @brief The list of this iterator.
         */
        List&amp; list_;

        /**
         * @brief Number of changes in the iterator list.
         */
        Counter count_;

        /**
         * @brief Last node of the iterator list.
         */
        Node*&amp; last_;

        /**
         * @brief Illegal value of the iterator list.
         */
        TT&amp; illegal_;

        /**
         * @brief Pointer to current node of this iterator that returned as next element.
         */
        Node* curs_;

        /**
         * @brief Index of element of list which can be removed by remove function.
         */
        int32_t rindex_;

    };
};

} // namespace lib
} // namespace eoos
#endif // LIB_CIRCULARLIST_HPP_</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>